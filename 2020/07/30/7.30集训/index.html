<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="#上午 第一题">
<meta property="og:type" content="article">
<meta property="og:title" content="7.30集训">
<meta property="og:url" content="http://example.com/2020/07/30/7.30%E9%9B%86%E8%AE%AD/index.html">
<meta property="og:site_name" content="Welcome to my blog!">
<meta property="og:description" content="#上午 第一题">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-30T13:30:30.000Z">
<meta property="article:modified_time" content="2022-09-19T03:35:03.854Z">
<meta property="article:author" content="Youngore">
<meta property="article:tag" content="集训">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2020/07/30/7.30%E9%9B%86%E8%AE%AD/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2020/07/30/7.30%E9%9B%86%E8%AE%AD/","path":"2020/07/30/7.30集训/","title":"7.30集训"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>7.30集训 | Welcome to my blog!</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Welcome to my blog!</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tag fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">第一题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">第二题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%A2%98"><span class="nav-number">3.</span> <span class="nav-text">第三题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8B%E5%8D%88"><span class="nav-number"></span> <span class="nav-text">下午</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA"><span class="nav-number">1.</span> <span class="nav-text">第一个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA"><span class="nav-number">2.</span> <span class="nav-text">第二个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA"><span class="nav-number">3.</span> <span class="nav-text">第三个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E4%B8%AA"><span class="nav-number">4.</span> <span class="nav-text">第四个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E4%B8%AA"><span class="nav-number">5.</span> <span class="nav-text">第五个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E4%B8%AA"><span class="nav-number">6.</span> <span class="nav-text">第六个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E4%B8%AA"><span class="nav-number">7.</span> <span class="nav-text">第七个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E4%B8%AA"><span class="nav-number">8.</span> <span class="nav-text">第八个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E4%B8%AA"><span class="nav-number">9.</span> <span class="nav-text">第九个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E9%93%BE"><span class="nav-number">10.</span> <span class="nav-text">项链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8Fb"><span class="nav-number">11.</span> <span class="nav-text">小B</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8Fz"><span class="nav-number">12.</span> <span class="nav-text">小Z</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%85%E4%BF%AE%E6%94%B9%E8%8E%AB%E9%98%9F"><span class="nav-number">13.</span> <span class="nav-text">待修改莫队</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Youngore"
      src="https://pic.imgdb.cn/item/63212a2d16f2c2beb14b0110.jpg">
  <p class="site-author-name" itemprop="name">Youngore</p>
  <div class="site-description" itemprop="description">Give it time, it will happen</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives">
          <span class="site-state-item-count">222</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Youngore" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Youngore" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/14334254/youngore" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;14334254&#x2F;youngore" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/30/7.30%E9%9B%86%E8%AE%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://pic.imgdb.cn/item/63212a2d16f2c2beb14b0110.jpg">
      <meta itemprop="name" content="Youngore">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my blog!">
      <meta itemprop="description" content="Give it time, it will happen">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="7.30集训 | Welcome to my blog!">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          7.30集训
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-30 21:30:30" itemprop="dateCreated datePublished" datetime="2020-07-30T21:30:30+08:00">2020-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-19 11:35:03" itemprop="dateModified" datetime="2022-09-19T11:35:03+08:00">2022-09-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9A%91%E5%81%87%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">暑假日常</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>#上午</p>
<h3 id="第一题">第一题</h3>
<span id="more"></span>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3173">巧克力</a></p>
<p>这题某谷数据水，<span
class="math inline">\(int\)</span>就过了，因为以前做过，所以这次理所当然的<strong>切了</strong></p>
<p>切了之后我还仔细查看是否需要LL，检查无误后，没开LL</p>
<p>但是教练的数据强，卡我50分，上次因为LL卡我100分</p>
<p>出题人学长<a
target="_blank" rel="noopener" href="https://youngscc.github.io/">Youngsc</a>的题是真的强.....</p>
<p>这题贪心做，把权值从小到大排序，排完之后干就完了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">// #define debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">in</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   LL x = <span class="number">0</span>, f = <span class="number">1</span>; <span class="type">char</span> ch;</span><br><span class="line">   <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch = <span class="built_in">getchar</span>()))(ch == <span class="string">&#x27;-&#x27;</span>) &amp;&amp; (f = -f);</span><br><span class="line">   <span class="keyword">for</span>(x = ch^<span class="number">48</span>;<span class="built_in">isdigit</span>(ch = <span class="built_in">getchar</span>()); x = (x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>));</span><br><span class="line">   <span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, res;</span><br><span class="line"><span class="type">int</span> sum1 = <span class="number">1</span>, sum2 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;<span class="type">int</span> val, tag;&#125;a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">cmp</span> <span class="params">(node x, node y)</span> </span>&#123;<span class="keyword">return</span> x.val &gt; y.val;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">   n = <span class="built_in">in</span>(), m = <span class="built_in">in</span>();</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n<span class="number">-1</span>; ++ i) a[i].val = <span class="built_in">in</span>(), a[i].tag = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = n; i &lt;= n+m<span class="number">-2</span>; ++ i) a[i].val = <span class="built_in">in</span>(), a[i].tag = <span class="number">2</span>;</span><br><span class="line">   <span class="built_in">sort</span> (a+<span class="number">1</span>, a+n+m<span class="number">-1</span>, cmp);</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n+m<span class="number">-2</span>; ++ i)</span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;val--&gt;&quot;</span> &lt;&lt; a[i].val &lt;&lt; <span class="string">&quot;tag--&gt;&quot;</span> &lt;&lt; a[i].tag &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n+m<span class="number">-2</span>; ++ i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[i].tag == <span class="number">1</span>) res += a[i].val*sum2, ++ sum1;</span><br><span class="line">      <span class="keyword">else</span> res += a[i].val*sum1, ++ sum2;</span><br><span class="line">   &#125;</span><br><span class="line">   cout &lt;&lt; res;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第二题">第二题</h3>
<p><img
src="https://pic.imgdb.cn/item/6327e36216f2c2beb13ca619.png" /></p>
<details>
<summary>
Sample input
</summary>
<pre><code>5 6
7 2 3 1 1
5 0 6 0 0
8 6 6 5 3
4 3 7 8 2
4 0 0 6 9
</code></pre>
</details>
<details>
<summary>
Sample output
</summary>
<pre><code>20
</code></pre>
</details>
<p>样例解释: 分别以<span
class="math inline">\((2,1)\)</span>为左上角<span
class="math inline">\((5,2)\)</span>为右下角和以<span
class="math inline">\((1,3)\)</span>为左上角以<span
class="math inline">\((4,5)\)</span>为右下角的两个矩阵。</p>
<p>数据范围:</p>
<p>对于<span class="math inline">\(20%\)</span>的数据<span
class="math inline">\(n \leq 5\)</span></p>
<p>对于<span class="math inline">\(50%\)</span>的数据<span
class="math inline">\(n \leq 50\)</span></p>
<p>另有<span
class="math inline">\(5%\)</span>的数据满足所有电脑的便利值均为<span
class="math inline">\(1\)</span></p>
<p>另另有<span
class="math inline">\(25%\)</span>的数据满足所有的电脑便利值相同</p>
<p>对于<span class="math inline">\(100%\)</span>的数据满足<span
class="math inline">\(n \leq 300\)</span>，<span class="math inline">\(p
\leq 50\)</span>，<span class="math inline">\(0 \leq a[i][j] \leq
65536\)</span></p>
<hr />
<p><strong>特别鸣谢<a
target="_blank" rel="noopener" href="https://home.cnblogs.com/u/kagula/">lpj</a>大佬，在我写完代码之后依旧迷迷糊糊的时候，帮我理清了思路</strong></p>
<p>首先对于这个题，观察数据范围发现<span
class="math inline">\(n\leq300,p\leq50,0\leq
a[i][j]\leq65536\)</span></p>
<p>我们可以考虑一个<span
class="math inline">\(n^4\)</span>的dp暴力，直接搞</p>
<p>但是这样是过不了全部数据的</p>
<p><span class="math inline">\(n \leq
300\)</span>我们考虑如何来优化一维</p>
<p>我们考虑用<span class="math inline">\(l\)</span>和<span
class="math inline">\(r\)</span>这两维来搞那个矩形长度，对于每一行，我们把那一行看成一个元素，对那一行求一个前缀和</p>
<p>这样再从纵列枚举一个<span
class="math inline">\(t\)</span>这样就转化成了三维</p>
我们来考虑主函数中的三个函数
<details>
<summary>
function
</summary>
<pre><code>shuruyijichushihua()
jiejuewenti()
shuchudaan()
</code></pre>
</details>
<p>其中第一个与第三个函数很简单</p>
我们来看jiejuewenti的函数
<details>
<summary>
function
</summary>
<pre><code>dodododo()
fanzhuan()
dododo()
</code></pre>
</details>
<p>先说明一下fanzhuan()，对于矩形一上一下的情况，我们必须将矩阵翻转过来，再干一遍</p>
<p>翻转可以有两种写法：</p>
way1:
<details>
<summary>
Code
</summary>
<pre><code>a[i][j] ^= a[j][i] ^= a[i][j] ^= a[j][i];
</code></pre>
</details>
<p>way2:</p>
<details>
<summary>
Code
</summary>
<pre><code>int x = a[i][j], y = a[j][i];
x ^= y;
y ^= x;
x ^= y;
a[i][j] = x;
a[j][i] = y;
</code></pre>
</details>
<p>表达意思是一样的</p>
<p>来看dodododo的函数</p>
<p>首先我们需要对每一行都搞一个前缀和，</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">      sum[i][j] = a[i][j], sum[i][j] += sum[i][j<span class="number">-1</span>];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>考虑用<span class="math inline">\(l,
r\)</span>来枚举当前这个矩形的长，枚举一个<span
class="math inline">\(i\)</span>来搞矩形的宽</p>
<p>这样我们就很好的可以枚举到每一个矩形的面积</p>
<p>对于当前枚举到的矩形的面积（<span class="math inline">\(zonghe +=
sum[i][r] - sum[i][l-1]\)</span>）</p>
<p>我们再来考虑搞一个记忆化的数组<span
class="math inline">\(t\)</span>，我们给p以内的数字都打上标记-1，</p>
<p>设k为当前总和模p之后的数字，考虑<span
class="math inline">\(t[k]\)</span>是否为-1</p>
<p>如果发现为-1，那就是以前没有出现过，我们更新标记<span
class="math inline">\(t[k] =
i\)</span>,表示上一次出现模p得到k的情况是i</p>
<p>如果发现<span
class="math inline">\(t[k]\)</span>不为-1，那么会有两种情况，</p>
<p>第一种：模p为0，是p的倍数</p>
<p>第二种：以前出现过模p得到k的情况</p>
<p>所以我们对于上面两种情况都可以更新答案</p>
<p>那么如何更新答案？</p>
<p>我们定义两个数组<span class="math inline">\(f,g\)</span>其中<span
class="math inline">\(f[i]\)</span>表示<strong>紧贴</strong>着<span
class="math inline">\(i\)</span>这条直线的左边的最大矩形</p>
<p><span class="math inline">\(g[i]\)</span>表示<span
class="math inline">\(i\)</span>这条直线的右边的最大矩形（不一定紧贴）</p>
<p><span class="math inline">\(f[r]\)</span>是紧贴着<span
class="math inline">\(r\)</span>这条线的左边的矩形的最大面积，<span
class="math inline">\((r-l+1)*(i-t[k])\)</span>不就是当前枚举到的最大面积吗？</p>
<p>更新就完事了</p>
<p><span class="math inline">\(g[l]\)</span>是<span
class="math inline">\(l\)</span>这条线右边的矩形的最大面积，和f数组一样，<span
class="math inline">\((r-l+1)*(i-t[k])\)</span>更新就完事了（注意当前还是紧贴着的，而我们<span
class="math inline">\(g[i]\)</span>的定义是贴不贴着i这条线都可以，所以我们的g数组一定还会更新）</p>
<p>当我们所有矩形都查找完毕之后，考虑再次更新<span
class="math inline">\(g\)</span>数组，至于为什么更新上文提到了已经</p>
<p>务必要倒序枚举，因为你如果顺序枚举的话，当前的答案可能会受到之后的答案的影响，所以当前答案就不是最优的</p>
<p>对于整体的真正答案，<span class="math inline">\(res = max(res,
f[i]+g[i+1])\)</span>，为什么要<span
class="math inline">\(i+1\)</span>？</p>
<p>再次考虑<span class="math inline">\(g\)</span>数组定义：表示<span
class="math inline">\(i\)</span>这条直线的右边的最大矩形（不一定紧贴）</p>
<p>不一定紧贴，万一紧贴了呢？两条边有重叠不就不满足题意了吗？所以要用<span
class="math inline">\(g[i+1]\)</span>。</p>
<p><strong>PS</strong>:</p>
<p>对于为什么在“第二种：以前出现过模p得到k的情况”的时候也要更新答案？“</p>
<p>我们重新考虑题意：一块矩形的和是p的倍数，也就是模p为零</p>
<p>可以用式子表示为：</p>
<p><span class="math inline">\(s_{当前} - s_{上一次} \equiv 0 (mod
p)\)</span></p>
<p>进一步转化为：</p>
<p><span class="math inline">\(s_{当前} \equiv s_{上一次} (mod
p)\)</span></p>
<p>所以可理解为，只要上一次和这一次在模p意义的数字一样，就可以更新答案了，因为他们相减之后一定是p的倍数，可手跑几组例子</p>
<p>至此，关于“第二种：以前出现过模p得到k的情况”的时候也要更新答案？”这句话，也就不难理解了</p>
<p>给出<span class="math inline">\(youngsc\)</span>的代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> R register</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> LL long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,p,a[<span class="number">310</span>][<span class="number">310</span>],f[<span class="number">310</span>],g[<span class="number">310</span>],ans,t[<span class="number">60</span>],x[<span class="number">310</span>][<span class="number">310</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">in</span><span class="params">(R T&amp; a)</span></span>&#123;</span><br><span class="line">   R <span class="type">char</span> c=<span class="built_in">getchar</span>(); R T x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) &#123;<span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>; c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">   <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">getchar</span>();</span><br><span class="line">   a=x*f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">maxx</span><span class="params">(R T&amp;a,R T b)</span></span>&#123;a&lt;b? a=b:<span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) f[i]=g[i]=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> j=<span class="number">1</span>; j&lt;=n; ++j)</span><br><span class="line">         a[i][j]=x[i][j],a[i][j]+=a[i][j<span class="number">-1</span>];</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> l=<span class="number">1</span>; l&lt;=n; ++l) &#123;</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> r=l; r&lt;=n; ++r) &#123;</span><br><span class="line">         R <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">	 <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;p; ++i) t[i]=<span class="number">-1</span>;</span><br><span class="line">	 <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">	    sum += a[i][r]-a[i][l<span class="number">-1</span>];</span><br><span class="line">	    sum %= p;</span><br><span class="line">	    <span class="keyword">if</span> (t[sum]!=<span class="number">-1</span>) <span class="built_in">maxx</span>(f[r],(r-l+<span class="number">1</span>)*(i-t[sum])),<span class="built_in">maxx</span>(g[l],(r-l+<span class="number">1</span>)*(i-t[sum]));</span><br><span class="line">	    <span class="keyword">else</span> t[sum] = i;</span><br><span class="line">	 &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=n<span class="number">-1</span>; i; --i) <span class="built_in">maxx</span>(g[i],g[i+<span class="number">1</span>]);</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;n; ++i) <span class="built_in">maxx</span>(ans,f[i]+g[i+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="built_in">in</span>(n),<span class="built_in">in</span>(p);</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> j=<span class="number">1</span>; j&lt;=n; ++j)</span><br><span class="line">         <span class="built_in">in</span>(x[i][j]);</span><br><span class="line">   <span class="built_in">solve</span>();</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> j=i+<span class="number">1</span>; j&lt;=n; ++j) </span><br><span class="line">	 x[i][j] ^= x[j][i] ^= x[i][j] ^= x[j][i];</span><br><span class="line">   <span class="built_in">solve</span>();</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(7.31update\)</span></p>
<p>自己写了一遍，给出自己的代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">321</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, p, res;</span><br><span class="line"><span class="type">int</span> f[N], g[N], t[N];</span><br><span class="line"><span class="type">int</span> a[N][N], sum[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuruyijichushihua</span><span class="params">()</span></span>&#123;</span><br><span class="line">   cin &gt;&gt; n &gt;&gt; p;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">         cin &gt;&gt; a[i][j];</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dododo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) f[i] = g[i] = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">          sum[i][j] = a[i][j], sum[i][j] += sum[i][j<span class="number">-1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= n; ++ l) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> r = l; r &lt;= n; ++ r) &#123;</span><br><span class="line">         <span class="type">int</span> zonghe = <span class="number">0</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; p; ++ i) t[i] = <span class="number">-1</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">            zonghe += sum[i][r] - sum[i][l<span class="number">-1</span>];</span><br><span class="line">	    zonghe %= p;</span><br><span class="line">            <span class="keyword">if</span> (t[zonghe] != <span class="number">-1</span>) &#123;</span><br><span class="line">	       f[r] = <span class="built_in">max</span>(f[r], (r-l+<span class="number">1</span>)*(i-t[zonghe]));</span><br><span class="line">	       g[l] = <span class="built_in">max</span>(g[l], (r-l+<span class="number">1</span>)*(i-t[zonghe]));</span><br><span class="line">            &#125; <span class="keyword">else</span> t[zonghe] = i;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = n<span class="number">-1</span>; i; -- i) g[i] = <span class="built_in">max</span>(g[i], g[i+<span class="number">1</span>]);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i != n<span class="number">-1</span>; ++ i) res = <span class="built_in">max</span>(res, f[i]+g[i+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">fanzhuan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = i+<span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">	 <span class="comment">// a[i][j] ^= a[j][i] ^= a[i][j] ^= a[j][i];</span></span><br><span class="line">         <span class="type">int</span> x = a[i][j], y = a[j][i];</span><br><span class="line">         x ^= y;</span><br><span class="line">	 y ^= x;</span><br><span class="line">	 x ^= y;</span><br><span class="line">	 a[i][j] = x;</span><br><span class="line">	 a[j][i] = y;</span><br><span class="line">      &#125; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiejuewenti</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="built_in">dododo</span>();</span><br><span class="line">   <span class="built_in">fanzhuan</span>();</span><br><span class="line">   <span class="built_in">dododo</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuchudaan</span><span class="params">()</span></span>&#123;cout &lt;&lt; res;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// freopen (&quot;matrix.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line"><span class="comment">// freopen (&quot;matrix.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">   <span class="built_in">shuruyijichushihua</span>();</span><br><span class="line">   <span class="built_in">jiejuewenti</span>();</span><br><span class="line">   <span class="built_in">shuchudaan</span>();</span><br><span class="line">   <span class="built_in">fclose</span> (stdin), <span class="built_in">fclose</span> (stdout);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> youngore = <span class="built_in">thestars</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(8.3update\)</span></p>
<p>给出<span class="math inline">\(youngsc\)</span>的题解：</p>
<hr />
<p>20pts:暴力枚举矩阵</p>
<p>50pts:可以采用正解中的部分做法优化暴力枚举的做法</p>
<p>Special
5pts:这部分其实就相当于数学题了，与形状无关，只需考虑是不是存在最大的矩阵使得面积是p的倍数就可以了</p>
<p>Special 25pts:同上</p>
<p>100 pts:</p>
<p>首先我们考虑一个弱化版的问题，如果我们只需要选择一块区域使得电脑台数最多该怎么办？</p>
<p>首先我们对矩阵中的每一行都做一个前缀和，那么对于任意单独一行的任意一个区间都可以在的时间内求出区间内的数字之和。</p>
<p>那么我们就可以先 <span class="math inline">\(a_i\)</span>
枚举所求矩阵的左右边界，当左右边界确定后，我们可以在每一行的前缀和的辅助下快速求出每一行在这个边界限制下的区间和，即将其变成一个数字，便可以将矩阵压缩为一个纵向的一维数组</p>
<p><img
src="https://pic.imgdb.cn/item/6327e39016f2c2beb13cd7ee.png" /></p>
<p>紧接着我们需要做的就是找到一个在这个一维数组中找到一个尽可能大的区间使得区间和是𝑝的倍数。我们依然考虑前缀和，定义𝑓𝑖表示数组中前𝑖项和对𝑝取模之后的值，由此我们可知，如果存在𝑥和𝑦使得𝑓𝑥=𝑓𝑦且𝑥&lt;𝑦，则由前缀和定义以及取模性质可知<span
class="math inline">\(\begin{aligned}\sum_{x+1} ^ y a_i\% p =
0\end{aligned}\)</span>，即该区间和为𝑝的倍数。那么我们可以想到对于每一个固定的𝑦，我们只需要找到最小的𝑥使得𝑥&lt;𝑦且𝑓𝑥=𝑓𝑦，那么这个区间就是以𝑦为右边界且区间和为𝑝的倍数的最大区间。而这个过程我没只需要从前往后扫一遍，维护一下对于𝑝取模后的每一个值在𝑓𝑖中出现的最早位置，同时查找一下与当前𝑓𝑖相等的最早出现的位置，二者做差即可，这个过程是𝑂(𝑛)的，这样我们便可以<span
class="math inline">\(𝑂(𝑛^3)\)</span>地求出面积最大的满足和是𝑝地倍数地矩阵。</p>
<p>当我们需要找到两个互不重叠的矩阵时该怎么办呢？首先我们可以想到，这两个矩阵地位置关系一定是上下或者左右，即必然存在一条竖直或者水平的分界线将这两个矩阵分隔开。对于左右地情况，我们维护两个数组𝑓和𝑔，𝑓𝑖表示以𝒊为右边界的符合条件的最大矩阵，𝑔𝑖表示以𝒊或者大于𝒊为左边界的符合条件的最大矩阵，注意二者定义有所不同。𝑓𝑖的求法很简单，只需要在上述预处理的过程中维护就行了，𝑔𝑖也和𝑓𝑖求法一样，只需要对这个数组再维护一下最大后缀和就可以了。有了这两个数组，我们只要枚举𝑖求出𝑓𝑖+𝑔𝑖的最大值就可以了，这个值时左右布局时候的答案，上下布局的话，我们将整个矩阵关于主对角线对称一下，然后从头开始重新进行一边这样的操作，最后两种情况取最大值。</p>
<p>End.</p>
<hr />
<h3 id="第三题">第三题</h3>
<p><img
src="https://pic.imgdb.cn/item/6327e3ae16f2c2beb13cf3ac.png" /></p>
<details>
<summary>
Sample input
</summary>
<pre><code>6 12
0 1 1 1 1 0
2 4 0
1 3 0
1 6 3
4 5 2
3 4 6
2 5 4
4 3 9
3 1 3
2 5 5
6 1 9
1 2 7
2 1 8
</code></pre>
</details>
<details>
<summary>
Sample input
</summary>
<pre><code>3 0
0 8
6 3
2 12
-1 -1
9 9
</code></pre>
</details>
<p>给出<span class="math inline">\(Youngsc\)</span>的代码：
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> R register</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> inf 200000000</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> N 50010</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,x,y,z,e,h[N],t[N],f[N],ans[N][<span class="number">2</span>],dis[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">zx</span>&#123;<span class="type">int</span> v,w,pre;&#125; ed[N*<span class="number">7</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">yy</span>&#123;</span><br><span class="line">   <span class="type">int</span> x,w;</span><br><span class="line">   <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> yy y) <span class="type">const</span> &#123;<span class="keyword">return</span> w&gt;y.w;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="comment">//priority_queue &lt;yy&gt; q;</span></span><br><span class="line">queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">in</span><span class="params">(R T&amp; a)</span></span>&#123;</span><br><span class="line">   R <span class="type">char</span> c=<span class="built_in">getchar</span>(); R T x=<span class="number">0</span>,f=<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) &#123;<span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">-1</span>; c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">   <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">getchar</span>();</span><br><span class="line">   a=x*f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">maxx</span><span class="params">(R T&amp;a,R T b)</span></span>&#123;a&lt;b? a=b:<span class="number">0</span>;&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">minn</span><span class="params">(R T&amp;a,R T b)</span></span>&#123;a&gt;b? a=b:<span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(R <span class="type">int</span> x,R <span class="type">int</span> y,R <span class="type">int</span> z)</span></span>&#123;</span><br><span class="line">   ed[++e] = (zx)&#123;y,z,h[x]&#125;;</span><br><span class="line">   h[x] = e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dij</span><span class="params">(R <span class="type">int</span> a,R <span class="type">int</span> b,R <span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="keyword">if</span> (t[i]==a&amp;&amp;f[i]==b) dis[i]=<span class="number">0</span>,q.<span class="built_in">push</span>(i); <span class="keyword">else</span> dis[i]=inf;</span><br><span class="line">   <span class="keyword">while</span> (!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">      R <span class="type">int</span> x=q.<span class="built_in">front</span>();</span><br><span class="line">      q.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> i=h[x]; i; i=ed[i].pre) &#123;</span><br><span class="line">         R <span class="type">int</span> v=ed[i].v;</span><br><span class="line">         <span class="keyword">if</span> (dis[v] &gt; dis[x]+ed[i].w) &#123;</span><br><span class="line">            dis[v]=dis[x]+ed[i].w;</span><br><span class="line">            <span class="keyword">if</span> (!vis[v]) vis[v]=<span class="number">1</span>,q.<span class="built_in">push</span>(v);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      vis[x]=<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="keyword">if</span> (t[i]==c&amp;&amp;f[i]!=b) <span class="built_in">minn</span>(ans[i][a^c],dis[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="built_in">in</span>(n),<span class="built_in">in</span>(m);</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">in</span>(t[i]),ans[i][<span class="number">0</span>]=ans[i][<span class="number">1</span>]=inf;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) <span class="built_in">in</span>(x),<span class="built_in">in</span>(y),<span class="built_in">in</span>(z),<span class="built_in">add</span>(y,x,z);</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> p=<span class="number">0</span>; p&lt;=<span class="number">15</span>; ++p) &#123;</span><br><span class="line">      <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="keyword">if</span> ((i&gt;&gt;p)&amp;<span class="number">1</span>) f[i]=<span class="number">1</span>; <span class="keyword">else</span> f[i]=<span class="number">0</span>;</span><br><span class="line">	 <span class="built_in">dij</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>); <span class="built_in">dij</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">	 <span class="built_in">dij</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>); <span class="built_in">dij</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	 <span class="built_in">dij</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>); <span class="built_in">dij</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">	 <span class="built_in">dij</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>); <span class="built_in">dij</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (R <span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i,<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ans[i][<span class="number">0</span>] == inf) <span class="built_in">printf</span>(<span class="string">&quot;-1 &quot;</span>); <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[i][<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">if</span> (ans[i][<span class="number">1</span>] == inf) <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>); <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans[i][<span class="number">1</span>]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p>
<p>下面给出自己八十分的代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">66</span>, INF = <span class="number">214748364</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, a[N];</span><br><span class="line"><span class="type">int</span> vis[N], dis[N], tot[N];</span><br><span class="line"><span class="type">int</span> ans[N][<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">queue&lt;<span class="type">int</span>&gt;q;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;<span class="type">int</span> to, val, nxt;&#125;e[N]; <span class="type">int</span> cnt, head[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiabian</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">   ++ cnt;</span><br><span class="line">   e[cnt].to = v, e[cnt].val = c;</span><br><span class="line">   e[cnt].nxt = head[u], head[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuruyijichushihua</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="built_in">scanf</span> (<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">      ans[i][<span class="number">0</span>] = ans[i][<span class="number">1</span>] = INF;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">      <span class="type">int</span> x, y, z;</span><br><span class="line">      cin &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">      <span class="built_in">jiabian</span> (x, y, z);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">zuiduanlusuanfa</span><span class="params">(<span class="type">int</span> t, <span class="type">int</span> b, <span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      dis[i] = INF;</span><br><span class="line">      <span class="keyword">if</span> (a[i] == t &amp;&amp; tot[i] == b)  &#123;</span><br><span class="line">      	 q.<span class="built_in">push</span>(i);</span><br><span class="line">	 vis[i] = <span class="literal">true</span>;</span><br><span class="line">	 dis[i] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">      <span class="type">int</span> x = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">      vis[x] = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; i; i = e[i].nxt) &#123;</span><br><span class="line">         <span class="type">int</span> y = e[i].to;</span><br><span class="line">	 <span class="keyword">if</span> (dis[x]+e[i].val&lt;dis[y]) &#123;</span><br><span class="line">	    dis[y] = dis[x]+e[i].val;</span><br><span class="line">	    <span class="keyword">if</span> (!vis[y]) &#123;</span><br><span class="line">	   	vis[y] = <span class="number">1</span>;</span><br><span class="line">	   	q.<span class="built_in">push</span>(y);</span><br><span class="line">	    &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[i] == s &amp;&amp; tot[i] != b) &#123;</span><br><span class="line">	 <span class="keyword">if</span> (ans[i][t^s] &gt; dis[i])</span><br><span class="line">	    ans[i][t^s] = dis[i];</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dodododo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="built_in">zuiduanlusuanfa</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="built_in">zuiduanlusuanfa</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">   <span class="built_in">zuiduanlusuanfa</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>); <span class="built_in">zuiduanlusuanfa</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">   <span class="built_in">zuiduanlusuanfa</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="built_in">zuiduanlusuanfa</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">   <span class="built_in">zuiduanlusuanfa</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>); <span class="built_in">zuiduanlusuanfa</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiejuewenti</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; ++ i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">	 tot[j] = (j&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">dodododo</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuchudaan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ans[i][<span class="number">0</span>] == INF) cout &lt;&lt; <span class="string">&quot;-1 &quot;</span>;</span><br><span class="line">      <span class="keyword">else</span> cout &lt;&lt; ans[i][<span class="number">0</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">      <span class="keyword">if</span> (ans[i][<span class="number">1</span>] == INF) <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span> cout &lt;&lt; ans[i][<span class="number">1</span>] &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="built_in">shuruyijichushihua</span>();</span><br><span class="line">   <span class="built_in">jiejuewenti</span>();</span><br><span class="line">   <span class="built_in">shuchudaan</span>();</span><br><span class="line">   <span class="built_in">fclose</span> (stdin), <span class="built_in">fclose</span> (stdout);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> youngore = <span class="built_in">thestars</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;;&#125;</span><br></pre></td></tr></table></figure>
<p>给出<span class="math inline">\(youngsc\)</span>的题解：</p>
<hr />
<p>可以创建一个虚点A，A指向所有A党城市，边权为0，其它正常边反着连，从这个虚点A跑一个最短路dij，到其它B党城市的距离，就是B党城市到最近A党城市的距离。</p>
<p>求B党城市到A党同理。</p>
<p>但是你发现他还要求你求出友好城市的距离，由于不能把自己算进去，所以这个不能直接搞出来。注意到n只开到五万而时限有2秒，所以两个log没问题。注意到每个点都有个编号，我们考虑按位选点进行多源最短路。还是反着建边，因为正着建边的最短路是一到多，而反着建边的最短路就是多到一的最短了，符合题目要求。</p>
<p>例如，将第?位为0的所有A阵营的点作为源扔进去跑最短路（可以理解为从一个超级源向这些点连了长度为0的边）然后用它更新所有第?位为1的点。这样能保证不会用自己求自己。</p>
<p>复杂度为<span class="math inline">\(O(nlog^2n)\)</span>，其中<span
class="math inline">\(nlogn\)</span>是<span
class="math inline">\(dij\)</span>，另外<span
class="math inline">\(logn\)</span>是按位给点分拨</p>
<p>End.</p>
<hr />
<hr />
<h1 id="下午">下午</h1>
<p>讲了分块莫队</p>
<p>分块大致思想：说白了就是一种暴力，一种温文尔雅的暴力</p>
<p>我们正常对序列进行某种操作，假如你不会什么线段树猫树树状数组，反正一堆树与数</p>
<p>我们貌似就只能<span
class="math inline">\(O(n^2)\)</span>了，给你个<span
class="math inline">\(1e5\)</span>的数据不<span
class="math inline">\(T\)</span>飞才怪</p>
<p>我们考虑如何来优化，首先对一个整体区间进行分块，块长<span
class="math inline">\(len\)</span> = <span
class="math inline">\(\sqrt{n}\)</span>，所以块的数量为<span
class="math inline">\(\sqrt{n}\)</span></p>
<p>对于一个极大的区间，我们将他们分块对待，对左半部分的残缺，我们暴力修改</p>
<p>对于右半部分的残缺，我们暴力修改，而对于中间部分的整块，我们特殊对待，打上<span
class="math inline">\(tag\)</span></p>
<p>本质上是基于暴力的，所以很好理解</p>
<p>给出大致代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">xiugai</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">      <span class="comment">//do do do..</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= pos[L]*len; ++ i) <span class="comment">//do do do...</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = pos[L]+<span class="number">1</span>; i &lt;= pos[R]<span class="number">-1</span>; ++ i)<span class="comment">//do do do...</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = (pos[R]<span class="number">-1</span>)*len+<span class="number">1</span>; i &lt;= R; ++ i)<span class="comment">//do do do...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">chaxun</span><span class="params">(<span class="type">int</span> now)</span> </span>&#123;cout &lt;&lt; a[now]+tag[pos[now]];&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   cin &gt;&gt; n;</span><br><span class="line">   len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      cin &gt;&gt; a[i];</span><br><span class="line">      pos[i] = (i<span class="number">-1</span>)/len+<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">xiugai</span>(l, r, c);</span><br><span class="line">   <span class="built_in">chaxun</span>(x);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析代码：</p>
<p>修改的时候首先对于两个端点，如果发现首尾在一个块内，暴力干就完了</p>
<p>如果不在一个块内，左-中-右，开始干，期间维护标记啥的</p>
<p>查询的时候输出要查询的键值，然后加上标记之类的</p>
<p>分块例题：数列分块入门<span class="math inline">\(1\)</span>~<span
class="math inline">\(9\)</span></p>
<p>下面来例个分析：</p>
<h3 id="第一个">第一个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6277">click</a></p>
<p>区间加，单点查，秒切</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 600000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">signed</span> n, len;</span><br><span class="line"><span class="type">int</span> pos[N], tag[N], a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( <span class="type">int</span> i = L;i&lt;=R;++i) a[i] += val;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = L;i&lt;=pos[L]*len;++i) a[i] += val;</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = pos[L]+<span class="number">1</span>;i&lt;=pos[R]<span class="number">-1</span>;++i) tag[i] += val;</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = (pos[R]<span class="number">-1</span>)*len+<span class="number">1</span>;i&lt;=R;++i) a[i] += val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">   n = <span class="built_in">Read</span> (), len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=n;++i) a[i] = <span class="built_in">Read</span> (), pos[i] = (i - <span class="number">1</span>)/len + <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">      <span class="type">int</span> opt, l, r, c;</span><br><span class="line">      opt = <span class="built_in">Read</span> (), l = <span class="built_in">Read</span> (), r = <span class="built_in">Read</span> (), c = <span class="built_in">Read</span> ();</span><br><span class="line">      <span class="keyword">if</span> (!opt) <span class="built_in">add</span> (l, r, c);</span><br><span class="line">      <span class="keyword">else</span> <span class="built_in">Put</span> (a[r] + tag[pos[r]]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第二个">第二个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6278">click</a></p>
<p>我们考虑对原数组再开一个新数组来维护，</p>
<p><strong>查询的时候</strong></p>
<p>对于整块，我们给他排序，然后在排完序的序列里面二分查找小于val的数的个数</p>
<p>对于散块，暴力找</p>
<p><strong>修改的时候</strong></p>
<p>对于整块，我们给原数组和排完序之后的数组都要加上tag标记</p>
<p>对于散块，暴力加，加完之后，再排完序赋给排序数组</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">66</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, len, a[N];</span><br><span class="line"><span class="type">int</span> pos[N], paixu[N];</span><br><span class="line"><span class="type">int</span> tag[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuruyijichushihua</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        paixu[i] = a[i];</span><br><span class="line">        pos[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= pos[n]; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> s = (i - <span class="number">1</span>) * len + <span class="number">1</span>, t = i * len;</span><br><span class="line">        <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> now = (pos[n] - <span class="number">1</span>) * len + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(paixu + now, paixu + n + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">zaimougequjianjiashangyigeshu</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++i) a[i] += val;</span><br><span class="line">        s = (pos[L] - <span class="number">1</span>) * len + <span class="number">1</span>, t = pos[L] * len;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">        <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= pos[L] * len; ++i) a[i] += val;</span><br><span class="line">    s = (pos[L] - <span class="number">1</span>) * len + <span class="number">1</span>, t = (pos[L] * len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">    <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos[L] + <span class="number">1</span>; i &lt;= pos[R] - <span class="number">1</span>; ++i) tag[i] += val;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = (pos[R] - <span class="number">1</span>) * len + <span class="number">1</span>; i &lt;= R; ++i) a[i] += val;</span><br><span class="line">    s = (pos[R] - <span class="number">1</span>) * len + <span class="number">1</span>, t = pos[R] * len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">    <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">xiaoyumougeshudegeshu</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> who)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">res</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++i)</span><br><span class="line">            <span class="keyword">if</span> (a[i] + tag[pos[R]] &lt; who)</span><br><span class="line">                ++res;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= pos[L] * len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (a[i] + tag[pos[L]] &lt; who)</span><br><span class="line">            ++res;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos[L] + <span class="number">1</span>; i &lt;= pos[R] - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> now = (i - <span class="number">1</span>) * len + <span class="number">1</span>, to = i * len;</span><br><span class="line">        <span class="type">int</span> chazhao = <span class="built_in">lower_bound</span>(paixu + now, paixu + to + <span class="number">1</span>, (who - tag[i])) - paixu;</span><br><span class="line">        res += chazhao - now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = (pos[R] - <span class="number">1</span>) * len + <span class="number">1</span>; i &lt;= R; ++i)</span><br><span class="line">        <span class="keyword">if</span> (a[i] + tag[pos[R]] &lt; who)</span><br><span class="line">            ++res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiejuewentiyijishuchu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> opt, l, r, c;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">zaimougequjianjiashangyigeshu</span>(l, r, c);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cout &lt;&lt; <span class="built_in">xiaoyumougeshudegeshu</span>(l, r, c * c) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shuruyijichushihua</span>();</span><br><span class="line">    <span class="built_in">jiejuewentiyijishuchu</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> youngore = <span class="built_in">thestars</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123; ; &#125;</span><br></pre></td></tr></table></figure>
<p>自己写了一遍，坑很多，比如，我们排序的时候的数组，还有我们<strong>必须给原数组修改，然后赋值给那一段区间，再排序</strong>
建议以后把每个块的左右端点都开个数组就好了</p>
<h3 id="第三个">第三个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6279">click</a></p>
<p>前驱：比ta小的最大的元素</p>
<p>感觉和第二个一样，维护两个数组就好</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">66</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, len, a[N];</span><br><span class="line"><span class="type">int</span> pos[N], paixu[N];</span><br><span class="line"><span class="type">int</span> tag[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuruyijichushihua</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   cin &gt;&gt; n;</span><br><span class="line">   len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">      cin &gt;&gt; a[i];</span><br><span class="line">      paixu[i] = a[i];</span><br><span class="line">      pos[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; pos[n]; ++i) &#123;</span><br><span class="line">      <span class="type">int</span> s = (i - <span class="number">1</span>) * len + <span class="number">1</span>, t = i * len;</span><br><span class="line">      <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">int</span> now = (pos[n] - <span class="number">1</span>) * len + <span class="number">1</span>;</span><br><span class="line">   <span class="built_in">sort</span>(paixu + now, paixu + n + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">zaimougequjianjiashangyigeshu</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> s = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++i) a[i] += val;</span><br><span class="line">      s = (pos[L] - <span class="number">1</span>) * len + <span class="number">1</span>, t = pos[L] * len;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">      <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= pos[L] * len; ++i) a[i] += val;</span><br><span class="line">   s = (pos[L] - <span class="number">1</span>) * len + <span class="number">1</span>, t = (pos[L] * len);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">   <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = pos[L] + <span class="number">1</span>; i &lt;= pos[R] - <span class="number">1</span>; ++i) tag[i] += val;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = (pos[R] - <span class="number">1</span>) * len + <span class="number">1</span>; i &lt;= R; ++i) a[i] += val;</span><br><span class="line">   s = (pos[R] - <span class="number">1</span>) * len + <span class="number">1</span>, t = pos[R] * len;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i) paixu[i] = a[i];</span><br><span class="line">   <span class="built_in">sort</span>(paixu + s, paixu + t + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">xiaoyumougeshudegeshu</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> who)</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="type">int</span> <span class="title">res</span><span class="params">(<span class="number">-1</span>)</span>, <span class="title">s</span><span class="params">(<span class="number">0</span>)</span>, <span class="title">t</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">   <span class="keyword">if</span> (pos[L] == pos[R]) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++i)</span><br><span class="line">         <span class="keyword">if</span> (a[i]+tag[pos[L]] &lt; who) res = <span class="built_in">max</span>(res, a[i]+tag[pos[L]]);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   s = L, t = pos[L]*len;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i)</span><br><span class="line">      <span class="keyword">if</span> (a[i]+tag[pos[L]] &lt; who) res = <span class="built_in">max</span>(res, a[i]+tag[pos[L]]);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = pos[L] + <span class="number">1</span>; i &lt;= pos[R] - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">      s = (i - <span class="number">1</span>) * len + <span class="number">1</span>, t = i * len;</span><br><span class="line">      <span class="type">int</span> now = <span class="built_in">lower_bound</span>(paixu+s, paixu+t+<span class="number">1</span>, (who-tag[i])) - paixu;</span><br><span class="line">      -- now;</span><br><span class="line">      res = (now==s<span class="number">-1</span>)?res:(res&gt;paixu[now]+tag[i])?res:paixu[now]+tag[i];</span><br><span class="line">   &#125;</span><br><span class="line">   s = (pos[R]<span class="number">-1</span>)*len+<span class="number">1</span>, t = R;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = s; i &lt;= t; ++i)</span><br><span class="line">      <span class="keyword">if</span> (a[i]+tag[pos[R]] &lt; who) res = <span class="built_in">max</span>(res, a[i]+tag[pos[R]]);</span><br><span class="line">   <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiejuewentiyijishuchu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">      <span class="type">int</span> opt, l, r, c;</span><br><span class="line">      cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line">      <span class="keyword">if</span> (opt == <span class="number">0</span>) <span class="built_in">zaimougequjianjiashangyigeshu</span>(l, r, c);</span><br><span class="line">      <span class="keyword">else</span> cout &lt;&lt; <span class="built_in">xiaoyumougeshudegeshu</span>(l, r, c) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="built_in">shuruyijichushihua</span>();</span><br><span class="line">   <span class="built_in">jiejuewentiyijishuchu</span>();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> youngore = <span class="built_in">thestars</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123; ; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(8.2update\)</span>:</p>
<p>自己打了一遍，靠，真的细节真多：</p>
<p>1.在块里面更新答案的时候，必须加上tag标记</p>
<p>2.<span class="math inline">\(sort\)</span>，<span
class="math inline">\(lower\)</span>_<span
class="math inline">\(bound\)</span>都是左闭右开的</p>
<h3 id="第四个">第四个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6280">click</a></p>
<p>一眼板子，模的时候最后进行</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="comment">// #define debug</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">66</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, len, a[N];</span><br><span class="line"><span class="type">int</span> pos[N], sum[N], tag[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> x = pos[L], y = pos[R];</span><br><span class="line">   <span class="keyword">if</span> (x == y) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++ i) a[i] += val;</span><br><span class="line">      sum[x] += val*(R-L+<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= x*len; ++ i) a[i] += val;</span><br><span class="line">   sum[x] += val*(x*len-L+<span class="number">1</span>);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = x+<span class="number">1</span>; i &lt;= y<span class="number">-1</span>; ++ i) tag[i] += val;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = (y<span class="number">-1</span>)*len+<span class="number">1</span>; i &lt;= R; ++ i) a[i] += val;</span><br><span class="line">   sum[y] += val*(R-((y<span class="number">-1</span>)*len+<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">get_sum</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> x = pos[L], y = pos[R], <span class="built_in">res</span>(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">if</span> (x == y) &#123;</span><br><span class="line">      <span class="function"><span class="type">int</span> <span class="title">res</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= R; ++ i) res += (tag[pos[i]]+a[i]);</span><br><span class="line">      <span class="keyword">return</span> res%mod;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = L; i &lt;= x*len; ++ i) res += (tag[pos[i]]+a[i]);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = x+<span class="number">1</span>; i &lt;= y<span class="number">-1</span>; ++ i) res += sum[i] + tag[i]*len;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = (y<span class="number">-1</span>)*len+<span class="number">1</span>; i &lt;= R; ++ i) res += (tag[pos[i]]+a[i]);</span><br><span class="line">   <span class="keyword">return</span> res%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">shuru</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   cin &gt;&gt; n;</span><br><span class="line">   len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="built_in">scanf</span> (<span class="string">&quot;%lld&quot;</span>, &amp;a[i]);</span><br><span class="line">      pos[i] = (i<span class="number">-1</span>)/len+<span class="number">1</span>;</span><br><span class="line">      sum[pos[i]] += a[i];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jiejue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">      <span class="type">int</span> opt, l, r, c;</span><br><span class="line">      <span class="built_in">scanf</span> (<span class="string">&quot;%lld%lld%lld%lld&quot;</span>, &amp;opt, &amp;l, &amp;r, &amp;c);</span><br><span class="line">      <span class="keyword">if</span> (!opt) <span class="built_in">add</span>(l, r, c);</span><br><span class="line">      <span class="keyword">else</span> cout &lt;&lt; <span class="built_in">get_sum</span>(l, r, c+<span class="number">1</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">thestars</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="built_in">shuru</span>();</span><br><span class="line">   <span class="built_in">jiejue</span>();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> youngore = <span class="built_in">thestars</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;;&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(8.2update\)</span>:</p>
<p>时隔半年，重新手写了一遍，发现几个问题：</p>
<p>1.在区间修改的时候，<span
class="math inline">\(tag\)</span>数组进行维护，但是不用动<span
class="math inline">\(sum\)</span>数组（维护整块的时候）</p>
<p>2.查询整块的时候，输出<span
class="math inline">\(sum+tag*len\)</span></p>
<h3 id="第五个">第五个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6281">click</a></p>
<p>显然，一个数开方不会超过六次就会变成1</p>
<p>如果每次区间开方的数不涉及完整块，意味着不超过<span
class="math inline">\(2\sqrt{n}\)</span>个元素，直接暴力</p>
<p>如果涉及了完整的块，这些块经过几次操作之后，都会变成1，所以我们需要记录这些块经过每次操作之后，区间里面是不是都变成了1，如果是的话，那么我们以后需要查询这些块，只需要加上<span
class="math inline">\(1*len\)</span>就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by hzw</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi acos(-1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,blo;</span><br><span class="line"><span class="type">int</span> bl[<span class="number">50005</span>];</span><br><span class="line"><span class="type">int</span> v[<span class="number">50005</span>],sum[<span class="number">50005</span>],flag[<span class="number">50005</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve_sqrt</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(flag[x])<span class="keyword">return</span>;</span><br><span class="line">    flag[x]=<span class="number">1</span>;</span><br><span class="line">    sum[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(x<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=x*blo;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        v[i]=<span class="built_in">sqrt</span>(v[i]),sum[x]+=v[i];</span><br><span class="line">        <span class="keyword">if</span>(v[i]&gt;<span class="number">1</span>)flag[x]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=<span class="built_in">min</span>(bl[a]*blo,b);i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum[bl[a]]-=v[i];</span><br><span class="line">        v[i]=<span class="built_in">sqrt</span>(v[i]);</span><br><span class="line">        sum[bl[a]]+=v[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(bl[a]!=bl[b])</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=(bl[b]<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=b;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            sum[bl[b]]-=v[i];</span><br><span class="line">            v[i]=<span class="built_in">sqrt</span>(v[i]);</span><br><span class="line">            sum[bl[b]]+=v[i];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=bl[a]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;i++)</span><br><span class="line">        <span class="built_in">solve_sqrt</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=<span class="built_in">min</span>(bl[a]*blo,b);i++)</span><br><span class="line">        ans+=v[i];</span><br><span class="line">    <span class="keyword">if</span>(bl[a]!=bl[b])</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=(bl[b]<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=b;i++)</span><br><span class="line">            ans+=v[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=bl[a]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;i++)</span><br><span class="line">        ans+=sum[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    n=<span class="built_in">read</span>();blo=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)v[i]=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        bl[i]=(i<span class="number">-1</span>)/blo+<span class="number">1</span>;</span><br><span class="line">        sum[bl[i]]+=v[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> f=<span class="built_in">read</span>(),a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>(),c=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">0</span>)<span class="built_in">add</span>(a,b,c);</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(a,b));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第六个">第六个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6282">click</a></p>
<p>考虑，插入一个数的话，分块需要<span
class="math inline">\(O(n)\)</span>，而对于链表来说的话，只需要<span
class="math inline">\(O(1)\)</span></p>
<p>考虑，查询一个数的话，分块只需要<span
class="math inline">\(O(1)\)</span>，而对于链表来说的话，需要<span
class="math inline">\(O(n)\)</span></p>
<p>考虑，将分块与链表结合起来，----&gt;块状链表</p>
<p>块状链表应该至少支持：分裂、插入、查找。
什么是分裂？分裂就是分裂一个<span class="math inline">\(node\)</span>
，变成两个小的 <span class="math inline">\(node\)</span> ，以保证每个
<span class="math inline">\(node\)</span> 的大小都接近 <span
class="math inline">\(O(\sqrt{n})\)</span>（否则可能退化成普通数组）。当一个
<span class="math inline">\(node\)</span>的大小超过<span
class="math inline">\(2*\sqrt{n}\)</span> 时执行分裂操作。</p>
<p>块状链表即插入<span
class="math inline">\(O(\sqrt{n})\)</span>，查询<span
class="math inline">\(O(\sqrt{n})\)</span>，将链表与分块的优缺点融合了一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">  node* nxt;</span><br><span class="line">  <span class="type">int</span> size;</span><br><span class="line">  <span class="type">char</span> d[(sqn &lt;&lt; <span class="number">1</span>) + <span class="number">5</span>];</span><br><span class="line">  <span class="built_in">node</span>() &#123; size = <span class="number">0</span>, nxt = <span class="literal">NULL</span>, <span class="built_in">memset</span>(d, <span class="number">0</span>, <span class="built_in">sizeof</span>(d)); &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">pb</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123; d[size++] = c; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>查询的时候，挨个块的找，最多<span
class="math inline">\(O(\sqrt{n})\)</span>，插入的时候<span
class="math inline">\(O(\sqrt{n})\)</span></p>
<p>分裂操作怎么做呢？先新建一个节点，再把被分裂的节点的后<span
class="math inline">\(O(\sqrt{n})\)</span>个值复制到新节点，然后把被分裂的节点的后<span
class="math inline">\(O(\sqrt{n})\)</span>个值删掉（ <span
class="math inline">\(--
size\)</span>），最后把新节点插入到被分裂节点的后面即可</p>
<p>块状链表的所有操作的复杂度都是<span
class="math inline">\(O(\sqrt{n})\)</span>的。</p>
<h3 id="第七个">第七个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6283">click</a></p>
<p>一眼线段树，维护一个乘法标记和一个加法标记，下放标记的时候先下放乘法再下放加法</p>
<p>线段树会写，分块不会写</p>
<p>若当前的一个块乘以<span class="math inline">\(m_1\)</span>后加上<span
class="math inline">\(a_1\)</span>，这时进行一个乘<span
class="math inline">\(m_2\)</span>的操作，则原来的标记变成<span
class="math inline">\(m_1*m_2\)</span>，<span
class="math inline">\(a_1*m_2\)</span></p>
<p>若当前的一个块乘以<span class="math inline">\(m_1\)</span>后加上<span
class="math inline">\(a_1\)</span>，这时进行一个加<span
class="math inline">\(a_2\)</span>的操作，则原来的标记变成<span
class="math inline">\(m_1\)</span>，<span
class="math inline">\(a_1+a_1\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//by hzw</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 10007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi acos(-1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,blo;</span><br><span class="line"><span class="type">int</span> v[<span class="number">100005</span>],bl[<span class="number">100005</span>],atag[<span class="number">1005</span>],mtag[<span class="number">1005</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reset</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(x<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=<span class="built_in">min</span>(n,x*blo);i++)</span><br><span class="line">        v[i]=(v[i]*mtag[x]+atag[x])%mod;</span><br><span class="line">    atag[x]=<span class="number">0</span>;mtag[x]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> f,<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">reset</span>(bl[a]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=<span class="built_in">min</span>(bl[a]*blo,b);i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">0</span>)v[i]+=c;</span><br><span class="line">        <span class="keyword">else</span> v[i]*=c;</span><br><span class="line">        v[i]%=mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(bl[a]!=bl[b])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">reset</span>(bl[b]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=(bl[b]<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=b;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(f==<span class="number">0</span>)v[i]+=c;</span><br><span class="line">            <span class="keyword">else</span> v[i]*=c;</span><br><span class="line">            v[i]%=mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=bl[a]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">0</span>)atag[i]=(atag[i]+c)%mod;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            atag[i]=(atag[i]*c)%mod;</span><br><span class="line">            mtag[i]=(mtag[i]*c)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    n=<span class="built_in">read</span>();blo=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)v[i]=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)bl[i]=(i<span class="number">-1</span>)/blo+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=bl[n];i++)mtag[i]=<span class="number">1</span>;        </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> f=<span class="built_in">read</span>(),a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>(),c=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span>(f==<span class="number">2</span>)<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,(v[b]*mtag[bl[b]]+atag[bl[b]])%mod);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">solve</span>(f,a,b,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第八个">第八个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6284">click</a></p>
<p>区间变成问题，对于一个区间，我们维护一个标记，如果一个区间的标记是c，我们之间不查询这一段，直接加上这一段的长度就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//by hzw</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi acos(-1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,blo;</span><br><span class="line"><span class="type">int</span> v[<span class="number">100005</span>],bl[<span class="number">100005</span>],tag[<span class="number">100005</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reset</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tag[x]==<span class="number">-1</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(x<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=blo*x;i++)</span><br><span class="line">        v[i]=tag[x];</span><br><span class="line">    tag[x]=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">reset</span>(bl[a]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=<span class="built_in">min</span>(bl[a]*blo,b);i++)</span><br><span class="line">        <span class="keyword">if</span>(v[i]!=c)v[i]=c;</span><br><span class="line">        <span class="keyword">else</span> ans++;</span><br><span class="line">    <span class="keyword">if</span>(bl[a]!=bl[b])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">reset</span>(bl[b]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=(bl[b]<span class="number">-1</span>)*blo+<span class="number">1</span>;i&lt;=b;i++)</span><br><span class="line">            <span class="keyword">if</span>(v[i]!=c)v[i]=c;</span><br><span class="line">            <span class="keyword">else</span> ans++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=bl[a]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;i++)</span><br><span class="line">        <span class="keyword">if</span>(tag[i]!=<span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(tag[i]!=c)tag[i]=c;</span><br><span class="line">            <span class="keyword">else</span> ans+=blo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=(i<span class="number">-1</span>)*blo+<span class="number">1</span>;j&lt;=i*blo;j++)</span><br><span class="line">                <span class="keyword">if</span>(v[j]!=c)v[j]=c;</span><br><span class="line">                <span class="keyword">else</span> ans++;</span><br><span class="line">            tag[i]=c;</span><br><span class="line">        &#125;    </span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(tag,<span class="number">-1</span>,<span class="built_in">sizeof</span>(tag));</span><br><span class="line">    n=<span class="built_in">read</span>();blo=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)v[i]=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)bl[i]=(i<span class="number">-1</span>)/blo+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>(),c=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">solve</span>(a,b,c));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第九个">第九个</h3>
<p><a target="_blank" rel="noopener" href="https://loj.ac/problem/6285">click</a>&amp;&amp;<a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4168">click</a></p>
<p>找众数问题，自古以来众数就是个毒瘤</p>
<p>考虑答案的来源：1.所有完整快的最小众数。2.来自不完整块的某个数</p>
<p>我们可以预先处理好<span class="math inline">\(i_块\)</span>到<span
class="math inline">\(j_块\)</span>的所有数的最小众数，以便处理第一种情况的时候<span
class="math inline">\(O(1)\)</span>得到</p>
<p>我们定义两个数组：</p>
<p><span class="math inline">\(p[i][j]\)</span>：表示<span
class="math inline">\(i_块\)</span>到<span
class="math inline">\(j_块\)</span>的所有数的最小众数</p>
<p><span class="math inline">\(s[i][j]\)</span>：类似前缀和，表示前<span
class="math inline">\(i\)</span>个块中<span
class="math inline">\(j\)</span>（离散化）出现了几次</p>
<p>对于<span
class="math inline">\(s\)</span>数组，我们枚举到每一个块的时候，都要从前往后扫一遍，时间复杂度<span
class="math inline">\(O(n\sqrt{n})\)</span></p>
<p>对于<span class="math inline">\(p\)</span>数组，我们肯定要枚举<span
class="math inline">\(n^2\)</span>,然后在每一个块内，我们都要去判断，所以总复杂度：<span
class="math inline">\(O(\sqrt{n}\sqrt{n}\sqrt{n})\)</span>，总时间复杂度为<span
class="math inline">\(O(n\sqrt{n})\)</span></p>
<p>考虑<span class="math inline">\(p, s\)</span>有何用处，对于一个<span
class="math inline">\([l, r]\)</span>，设<span
class="math inline">\(l\)</span>在<span
class="math inline">\(posl\)</span>块中，设<span
class="math inline">\(r\)</span>在<span
class="math inline">\(posr\)</span>块中</p>
<p>此时我们会出现两种情况：</p>
<ol type="1">
<li><span class="math inline">\(posr - posl \leq 1\)</span>
此时暴力修改就可以了，复杂度<span
class="math inline">\(O(\sqrt{n})\)</span></li>
<li><span class="math inline">\(posr - posl \geq 2\)</span>如图：<img
src="https://cdn.luogu.com.cn/upload/pic/33249.png" alt="img" /></li>
</ol>
<p>红线是<span class="math inline">\(l\)</span>, 蓝线是<span
class="math inline">\(r\)</span>，绿线就是他们之间的块</p>
<p>所以此时的<span class="math inline">\(ans \in 元素_{yellow} \bigcup
众数_{green}\)</span></p>
<p>显然，对于绿线中的众数，我们是提前预处理出来的，而对于黄线中每个元素出现的次数就是你左右两边暴力求出来的，加上绿线中这个元素出现的个数</p>
<p>这样的话，对于每次询问，我们就可以在<span
class="math inline">\(O(\sqrt{n})\)</span>的时间内求出答案（不考虑预处理）</p>
<p><strong>我的分析已经超出了LOJ那道题，那道题并没有强制要求在线，莫队就可以完美解决那个问题，更多的分析，是针对蒲公英那道题</strong></p>
<p><strong>一般对于代码，我都会手动格式化，但是hzw的代码，我始终怀着一种敬畏尊重而神圣的感情，我没有修改他的码风</strong></p>
<p><strong>因为我知道他一定会是我的学长</strong></p>
<hr />
<p>通过学习数列简单分块，我们可以总结出，我们对于一个分块要维护什么：</p>
<ol type="1">
<li>不完整的块怎么处理？</li>
<li>完整的块怎么处理？</li>
<li>预处理什么？</li>
</ol>
<p>下面是莫队的相关操蛋操作</p>
<p>给出几个例题</p>
<h3 id="项链">项链</h3>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1972">click</a></p>
<p>莫队入门板子题正解是离线树状数组</p>
<h3 id="小b">小B</h3>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2709">click</a></p>
<p>遇到一个数，先减去他的贡献，在加上他的贡献</p>
<h3 id="小z">小Z</h3>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1494">click</a></p>
<p>埋坑....,我也不知道为什么我的代码能过</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">By TheStars</span></span><br><span class="line"><span class="comment">Time:2020.02.02</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500009</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//燕园情 千千结 </span></span><br><span class="line"><span class="type">int</span> n, m, col[N], ans[N][<span class="number">3</span>], cnt[N];</span><br><span class="line"><span class="type">int</span> fz, fm, block, len;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">   <span class="type">int</span> l, r;</span><br><span class="line">   <span class="type">int</span> ord;</span><br><span class="line">&#125;e[N]; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">cmp</span> <span class="params">(Node x, Node y)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (x.l/block == y.l/block) <span class="keyword">return</span> x.r &lt; y.r;</span><br><span class="line">   <span class="keyword">return</span> x.l &lt; y.l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">   fz += cnt[x];</span><br><span class="line">   ++ cnt[x];</span><br><span class="line">   fm += len;</span><br><span class="line">   ++ len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">   -- cnt[x];</span><br><span class="line">   fz -= cnt[x];</span><br><span class="line">   -- len;</span><br><span class="line">   fm -= len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span> <span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> !y ? x : <span class="built_in">gcd</span>(y, x%y);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="type">int</span> <span class="title">l</span><span class="params">(<span class="number">1</span>)</span>, <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">   <span class="built_in">scanf</span> (<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">   block = n/<span class="built_in">sqrt</span>(m);</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span> (<span class="string">&quot;%d&quot;</span>, &amp;col[i]);</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span> (<span class="string">&quot;%d%d&quot;</span>, &amp;e[i].l, &amp;e[i].r), e[i].ord = i;</span><br><span class="line">   <span class="built_in">sort</span> (e+<span class="number">1</span>, e+n+<span class="number">1</span>, cmp);</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=m;++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (e[i].l == e[i].r) &#123;</span><br><span class="line">         ans[e[i].ord][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	 ans[e[i].ord][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	 <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> (l &gt; e[i].l) <span class="built_in">add</span> (col[--l]);</span><br><span class="line">      <span class="keyword">while</span> (r &gt; e[i].r) <span class="built_in">del</span> (col[r--]);</span><br><span class="line">      <span class="keyword">while</span> (l &lt; e[i].l) <span class="built_in">del</span> (col[l++]);</span><br><span class="line">      <span class="keyword">while</span> (r &lt; e[i].r) <span class="built_in">add</span> (col[++r]);</span><br><span class="line">      <span class="type">int</span> g = <span class="built_in">gcd</span>(fz, fm);</span><br><span class="line">      ans[e[i].ord][<span class="number">0</span>] = fz/g;</span><br><span class="line">      ans[e[i].ord][<span class="number">1</span>] = fm/g;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">1</span>;i&lt;=m;++i) cout &lt;&lt; ans[i][<span class="number">0</span>] &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; ans[i][<span class="number">1</span>] &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="待修改莫队">待修改莫队</h3>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1903">click</a></p>
<p>正常莫队都是离线的，不支持修改，对于这种待修改的，我们需要在原来<span
class="math inline">\(l, r\)</span>的基础上加上一维<span
class="math inline">\(t\)</span></p>
<p>称为<strong>时间戳</strong>，查询操作的时间戳，沿用最近一次修改的时间戳</p>
<p>跑主算法时定义当前时间戳为<span
class="math inline">\(t\)</span>，对于每个查询操作，如果当前时间戳相对太大了，说明已进行的修改操作比要求的多，就把之前改的改回来，反之往后改。</p>
<p>只有当当前区间和查询区间左右端点、时间戳均重合时，才认定区间完全重合，此时的答案才是本次查询的最终答案。</p>
<p><strong>通俗地讲，就是再弄一指针，在修改操作上跳来跳去，如果当前修改多了就改回来，改少了就改过去，直到次数恰当为止。</strong></p>
<p>这样，我们当前区间的移动方向从四个（<span
class="math inline">\([l−1,r]、[l+1,r]、[l,r−1]、[l,r+1]\)</span>）</p>
<p>变成了六个（<span
class="math inline">\([l−1,r,t]、[l+1,r,t]、[l,r−1,t]、[l,r+1,t]、[l,r,t−1]、[l,r,t+1]\)</span>）</p>
<p>嫖了一份代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> maxn 50500</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> maxc 1001000</span></span><br><span class="line"><span class="type">int</span> a[maxn], cnt[maxc], ans[maxn], belong[maxn];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">query</span> &#123;</span><br><span class="line">	<span class="type">int</span> l, r, time, id;</span><br><span class="line">&#125; q[maxn];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">modify</span> &#123;</span><br><span class="line">	<span class="type">int</span> pos, color, last;</span><br><span class="line">&#125; c[maxn];</span><br><span class="line"><span class="type">int</span> cntq, cntc, n, m, size, bnum;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cmp</span><span class="params">(query a, query b)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> (belong[a.l] ^ belong[b.l]) ? belong[a.l] &lt; belong[b.l] : ((belong[a.r] ^ belong[b.r]) ? belong[a.r] &lt; belong[b.r] : a.time &lt; b.time);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> isdigit(x) ((x) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; (x) &lt;= <span class="string">&#x27;9&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">   <span class="type">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">   <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c)) c = <span class="built_in">getchar</span>();</span><br><span class="line">   <span class="keyword">while</span>(<span class="built_in">isdigit</span>(c)) res = (res &lt;&lt; <span class="number">1</span>) + (res &lt;&lt; <span class="number">3</span>) + (c ^ <span class="number">48</span>), c = <span class="built_in">getchar</span>();</span><br><span class="line">   <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   n = <span class="built_in">read</span>(), m = <span class="built_in">read</span>();</span><br><span class="line">   size = <span class="built_in">pow</span>(n, <span class="number">2.0</span> / <span class="number">3.0</span>);</span><br><span class="line">   bnum = <span class="built_in">ceil</span>((<span class="type">double</span>)n / size);</span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= bnum; ++i) </span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> j = (i - <span class="number">1</span>) * size + <span class="number">1</span>; j &lt;= i * size; ++j) belong[j] = i;</span><br><span class="line">	 <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) </span><br><span class="line">	    a[i] = <span class="built_in">read</span>();</span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">      <span class="type">char</span> opt[<span class="number">100</span>];</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, opt);</span><br><span class="line">      <span class="keyword">if</span>(opt[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">         q[++cntq].l = <span class="built_in">read</span>();</span><br><span class="line">	 q[cntq].r = <span class="built_in">read</span>();</span><br><span class="line">	 q[cntq].time = cntc;</span><br><span class="line">	 q[cntq].id = cntq;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(opt[<span class="number">0</span>] == <span class="string">&#x27;R&#x27;</span>) &#123;</span><br><span class="line">         c[++cntc].pos = <span class="built_in">read</span>();</span><br><span class="line">	 c[cntc].color = <span class="built_in">read</span>();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">sort</span>(q + <span class="number">1</span>, q + cntq + <span class="number">1</span>, cmp);</span><br><span class="line">   <span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>, time = <span class="number">0</span>, now = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cntq; ++i) &#123;</span><br><span class="line">      <span class="type">int</span> ql = q[i].l, qr = q[i].r, qt = q[i].time;</span><br><span class="line">      <span class="keyword">while</span>(l &lt; ql) now -= !--cnt[a[l++]];</span><br><span class="line">      <span class="keyword">while</span>(l &gt; ql) now += !cnt[a[--l]]++;</span><br><span class="line">      <span class="keyword">while</span>(r &lt; qr) now += !cnt[a[++r]]++;</span><br><span class="line">      <span class="keyword">while</span>(r &gt; qr) now -= !--cnt[a[r--]];</span><br><span class="line">      <span class="keyword">while</span>(time &lt; qt) &#123;</span><br><span class="line">	 ++time;</span><br><span class="line">	 <span class="keyword">if</span>(ql &lt;= c[time].pos &amp;&amp; c[time].pos &lt;= qr) now -= !--cnt[a[c[time].pos]] - !cnt[c[time].color]++;</span><br><span class="line">	    <span class="built_in">swap</span>(a[c[time].pos], c[time].color);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span>(time &gt; qt) &#123;</span><br><span class="line">	 <span class="keyword">if</span>(ql &lt;= c[time].pos &amp;&amp; c[time].pos &lt;= qr) now -= !--cnt[a[c[time].pos]] - !cnt[c[time].color]++;</span><br><span class="line">	    <span class="built_in">swap</span>(a[c[time].pos], c[time].color);</span><br><span class="line">	    --time;</span><br><span class="line">      &#125;</span><br><span class="line">      ans[q[i].id] = now;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cntq; ++i) </span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#晚上</p>
<p>写博客 补坑</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E9%9B%86%E8%AE%AD/" rel="tag"># 集训</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/07/29/7.29%E9%9B%86%E8%AE%AD/" rel="prev" title="7.29集训">
                  <i class="fa fa-chevron-left"></i> 7.29集训
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/07/31/7.31%E9%9B%86%E8%AE%AD/" rel="next" title="7.31集训">
                  7.31集训 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Youngore</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
